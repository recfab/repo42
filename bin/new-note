#!/bin/bash
set -euo pipefail
# IFS=$'\n\t'

bin_dir=$(dirname "$0")

id="$(date '+%Y%m%d%H%M%S')"
timestamp=$(date '+%Y-%m-%dT%T%z')
title="$*"

file=$(realpath "$bin_dir/../pkm/drafts/$id.md")

if [[ -f "$file" ]]; then
  echo "failure: file already exists"
  exit 1
fi

cat << EOF > "$file"
---
id: $id
created: $timestamp
modified: $timestamp
---
# $title

* TODO fill out this note

EOF

link="[[$id]]"
echo "New note: $file"
echo "Link:     $link"

echo "$link" | pbcopy

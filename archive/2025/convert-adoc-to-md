#!/bin/bash
set -euo pipefail
IFS=$'\n\t'

function rollback() {
  git restore --staged notes
  git checkout notes
  git clean -f notes
}

trap rollback ERR

for f in $(git ls-files '**/*.adoc'); do
  echo -e "\033[2mConverting $f\033[0m"
  converted=${f/%.adoc/.md}

  git mv "$f" "$converted"
done
